<!DOCTYPE html>
<html>
<head>
    <title>Record a Sighting!</title>
    
    <!-- Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Rubik' rel='stylesheet' type='text/css'>
    
    <!-- Stylin -->
    <link href='../public/stylesheets/header_style.css' rel='stylesheet' type='text/css'>
    <link href='../public/stylesheets/form_style.css' rel='stylesheet' type='text/css'>
    
    <!-- Javascript -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script type="text/javascript" src="../public/scripts/data.js"></script>
    <script type="text/javascript" src="../public/scripts/resize-image.js"></script>	
	<script type="text/javascript" src="../public/scripts/typed.js"></script>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

</head>

<body>
    
    <div id="header">
        <div id="prev">
            <a href="" id="prev_text">go back</a>
            <a href="index.html" id="main_page" style="display:none">Map</a>
        </div>
        <div id="next">
            <a href="" id="next_text">continue</a>
            </div>
        <!-- <div id="page_title"></div> -->
        <div id="logo"><a href= "index.html" style="text-decoration:none; color:white;">JELLY WATCH</a></div>
    </div>
    

    <div id="form_div">
        <form id="form">

        <!-- #####################################
                JELLYFISH QUESTIONS 
        ##################################### --> 

        <div class="question_div visible" id="jellyfish_questions">

            <h4 class="question">How many of each species of jellyfish do you see?</h4>

                <input type="radio" name="none" id='none'> 
                    <label class="radio_label" for="none" id="label-none">
                        I don't see any jellyfish or salps
                    </label>
				<br/>

                <!-- Jellyfish Species -->

                <div class="col span_1_of_3 jellyfish">
                    <p class="species_name">Comb Jelly</p>
                    <img src="../public/img/Comb_Jelly.jpg" class="image">
                    <input type="radio" name="comb" value="1 - 10">
                        <label class="radio_label">1 - 10</label>
                    <input type="radio" name="comb" value="11 - 49">
                        <label class="radio_label"> 11 - 49</label>
                    <input type="radio" name="comb" value="51 - 100">   
                        <label class="radio_label"> 51 - 100</label>
                    <input type="radio" name="comb" value=">100">       
                        <label class="radio_label">100+</label>
                </div>
                <div class="col span_1_of_3 jellyfish">
                    <p class="species_name">Cigar Jelly</p>
                    <img src="../public/img/Cigar_Jelly.jpg" class="image">
                    <input type="radio" name="cigar" value="1 - 10">
                        <label class="radio_label">1 - 10</label>
                    <input type="radio" name="cigar" value="11 - 49">
                        <label class="radio_label"> 11 - 49</label>
                    <input type="radio" name="cigar" value="51 - 100">
                        <label class="radio_label"> 51 - 100</label>
                    <input type="radio" name="cigar" value=">100">
                        <label class="radio_label">100+</label>
                </div>
                <div class="col span_1_of_3 jellyfish">
                    <p class="species_name">Moon Jelly</p>
                    <img src="../public/img/Moon_Jelly.jpg" class="image">
                    <input type="radio" name="moon" value="1 - 10">
                        <label class="radio_label">1 - 10</label>
                    <input type="radio" name="moon" value="11 - 49">
                        <label class="radio_label"> 11 - 49</label>
                    <input type="radio" name="moon" value="51 - 100">
                        <label class="radio_label"> 51 - 100</label>
                    <input type="radio" name="moon" value=">100">
                        <label class="radio_label">100+</label>
                </div>

                <div class="col span_1_of_3 jellyfish">
                    <p class="species_name">Lion's Mane</p>
                    <img src="../public/img/Lions_Mane_Jelly.jpg" class="image">
                    <input type="radio" name="lions_mane" value="1 - 10">
                        <label class="radio_label">1 - 10</label>
                    <input type="radio" name="lions_mane" value="11 - 49">
                        <label class="radio_label"> 11 - 49</label>
                    <input type="radio" name="lions_mane" value="51 - 100">
                        <label class="radio_label"> 51 - 100</label>
                    <input type="radio" name="lions_mane" value=">100">
                        <label class="radio_label">100+</label>
                </div>
                <div class="col span_1_of_3 jellyfish">
                    <p class="species_name">Stinging Sea Nettle</p>
                    <img src="../public/img/Stinging_Sea_Nettle_Jelly.jpg" class="image">
                    <input type="radio" name="stinging" value="1 - 10">
                        <label class="radio_label">1 - 10</label>
                    <input type="radio" name="stinging" value="11 - 49">
                        <label class="radio_label"> 11 - 49</label>
                    <input type="radio" name="stinging" value="51 - 100">
                        <label class="radio_label"> 51 - 100</label>
                    <input type="radio" name="stinging" value=">100">
                        <label class="radio_label">100+</label>
                </div>
                <div class="col span_1_of_3 jellyfish">
                    <p class="species_name">Crystal Jelly</p>
                    <img src="../public/img/Crystal_Jelly.jpg" class="image">
                    <input type="radio" name="crystal" value="1 - 10">
                        <label class="radio_label">1 - 10</label>
                    <input type="radio" name="crystal" value="11 - 49">
                        <label class="radio_label"> 11 - 49</label>
                    <input type="radio" name="crystal" value="51 - 100">
                        <label class="radio_label"> 51 - 100</label>
                    <input type="radio" name="crystal" value=">100">
                        <label class="radio_label">100+</label>
                </div>

                <div class="col span_1_of_3 jellyfish">
                    <p class="species_name">Cross Jelly</p>
                    <img src="../public/img/Cross_Jelly.jpg" class="image">
                    <input type="radio" name="cross" value="1 - 10">
                        <label class="radio_label">1 - 10</label>
                    <input type="radio" name="cross" value="11 - 49">
                        <label class="radio_label"> 11 - 49</label>
                    <input type="radio" name="cross" value="51 - 100">
                        <label class="radio_label"> 51 - 100</label>
                    <input type="radio" name="cross" value=">100">
                        <label class="radio_label">100+</label>
                </div>
                <div class="col span_1_of_3 jellyfish">
                    <p class="species_name">Man o' War</p>
                    <img src="../public/img/Man_o_War_Jelly.jpeg" class="image">
                    <input type="radio" name="man_of_war" value="1 - 10">
                        <label class="radio_label">1 - 10</label>
                    <input type="radio" name="man_of_war" value="11 - 49">
                        <label class="radio_label"> 11 - 49</label>
                    <input type="radio" name="man_of_war" value="51 - 100">
                        <label class="radio_label"> 51 - 100</label>
                    <input type="radio" name="man_of_war" value=">100">
                        <label class="radio_label">100+</label>
                </div>
                <div class="col span_1_of_3 jellyfish">
                    <p class="species_name">Salps</p>
                    <img src="../public/img/Salps.jpg" class="image">
                    <input type="radio" name="salps" value="1 - 10">
                        <label class="radio_label">1 - 10</label>
                    <input type="radio" name="salps" value="11 - 49">
                        <label class="radio_label"> 11 - 49</label>
                    <input type="radio" name="salps" value="51 - 100">
                        <label class="radio_label"> 51 - 100</label>
                    <input type="radio" name="salps" value=">100">
                        <label class="radio_label">100+</label>
                </div>

                <div class="col span_1_of_3 jellyfish">
                    <p class="species_name">Freshwater Jellyfish</p>
                    <img src="../public/img/Freshwater_Jelly.jpg" class="image">
                    <input type="radio" name="freshwater" value="1 - 10">
                        <label class="radio_label">1 - 10</label>
                    <input type="radio" name="freshwater" value="11 - 49">
                        <label class="radio_label"> 11 - 49</label>
                    <input type="radio" name="freshwater" value="51 - 100">
                        <label class="radio_label"> 51 - 100</label>
                    <input type="radio" name="freshwater" value=">100">
                        <label class="radio_label">100+</label>
                </div>
                <div class="col span_1_of_3 jellyfish">
                    <p class="species_name">Other (See Photos)</p>
                    <img src="../public/img/Other.jpg" class="image">
                    <input type="radio" name="other" value="1 - 10">
                        <label class="radio_label">1 - 10</label>
                    <input type="radio" name="other" value="11 - 49">
                        <label class="radio_label"> 11 - 49</label>
                    <input type="radio" name="other" value="51 - 100">
                        <label class="radio_label"> 51 - 100</label>
                    <input type="radio" name="other" value=">100">
                        <label class="radio_label">100+</label>
                </div>
        </div> 

       <!-- #####################################
                MARINE ANIMALS QUESTIONS 
        ##################################### --> 

        <div class="question_div" id="marine_animals_questions">

            <h4 class="question">Do you see any of these species of marine animal nearby?</h4>
			
            <div class="col span_1_of_3 nearby_species">
                <img src="../public/img/Horseshoe_Crab.jpg" class="image">
                <p class="species_name"><input type="checkbox" name="marine" value="Horseshoe Crab" id='crab'> <label for='crab'>Horseshoe Crab</label></p>
            </div>

        </div> 

       <!-- #####################################
                WATER USE QUESTIONS
        ##################################### --> 

        <div class="question_div" id="water_use_questions">

                <h4 class="question"> How are people using the water nearby?</h4>
				<div class='uses'>
                       <input type="checkbox" name="water_use" value="No one is using the water" id='water-use-none'> <label for='water-use-none'>No one is using the water</label><br>
                       <input type="checkbox" name="water_use" value="Sunbathing" id='water-use-sunbathing'> <label for='water-use-sunbathing'>Sunbathing</label><br>
                       <input type="checkbox" name="water_use" value="Swimming" id='water-use-swimming'> <label for='water-use-swimming'>Swimming</label><br>
                       <input type="checkbox" name="water_use" value="Fishing from shore" id='water-use-fishing'> <label for='water-use-fishing'>Fishing from shore</label><br>
                       <input type="checkbox" name="water_use" value="Boating" id='water-use-boating'> <label for='water-use-boating'>Boating</label><br>
                       <input type="checkbox" name="water_use" value="Harvesting shellfish" id='water-use-harvesting'> <label for='water-use-harvesting'>Harvesting shellfish</label>
				 </div>

        </div>

       <!-- #####################################
                ENVIRONMENT QUESTIONS
        ##################################### --> 

        <div class="question_div" id="environment_questions">

            <h4 class="question">How clear is the water? </h4>
                    <input type="radio" name="water" value="Clear"> Clear
                <br><input type="radio" name="water" value="Turbid"> Turbid

            <h4 class="question">Do you see attached seaweed, typical on rocky shore? </h4>
                    <input type="radio" name="seaweed" value="Yes"> Yes
                <br><input type="radio" name="seaweed" value="No"> No

            <h4 class="question">Do you see unattached macroalgae blooms? </h4>
                    <input type="checkbox" name="macroalgae" value="None observed"> None observed
                <br><input type="checkbox" name="macroalgae" value="Green Sea Lettuce"> Green Sea Lettuce
                <br><input type="checkbox" name="macroalgae" value="Red Algae (Grateloupia)"> Red Algae (Grateloupia)
                <br><input type="checkbox" name="macroalgae" value="Brown Seaweed"> Brown Seaweed
                <br>Other: <input type="text" name="macroalgae" id="macroalgae_other">

        </div>

       <!-- #####################################
                PHOTO, COMMENTS, SUBMIT FORM
        ##################################### --> 

        <div class="question_div" id="photo_comments">

            <h4 class="question">Attach a photo! <em>optional</em></h4>
                <!--
                    <input type="file" name="photo">
                -->

                    <input type='file' />
                    <img id="myImg" src="#" alt="your image" />
            
            <h4 class="question">Any last comments?</h4>
                    <input type="text" name="comments" class="comments">

            <br><input type="submit">

        </div>

        </form>
    </div>

    <!-- #####################################
        Displayed on Form Submit Success
    ##################################### --> 
  <!--   <div id = "success" style="position: fixed; z-index: -99; width: 100%; height: 100%">
       <div class="convo">
           <span class="element" style="color:yellow"></span>
       </div>
    
    </div> -->

    <div id="success">
        <div id="success_blue" >
            <div class "mascot-wrapper" style="height:50px; margin-left:15%; padding-top:50%;">
                <span class="mascot" style="color:white; font-size:1.5em;">
                </span>
            </div>        
        </div>
    </div> 

   <!-- JAVASCRIPT STUFF --> 

    <script type='text/javascript'>
    var url; 
		
   if (!location.hash) location.href = 'index.html'
	   var hash = location.hash.substring(1)
	   var lat = parseFloat(hash.split(',')[0])
	   var lng = parseFloat(hash.split(',')[1])
		
        // ######################################
        // Show & hide divs based on next/prev button clicks
        // ######################################

        $(document).ready(function(){
            $('#success').hide();
        })

        $('#prev_text').click(function(e){
            e.preventDefault();
            if ($('.visible').attr('id')=="jellyfish_questions" || $('.visible').attr('id') == 'success_blue'){
                window.location.href="index.html" // go to MAP
            }

            $('#next_text').show();
            $('.visible').toggleClass('visible').prev().toggleClass('visible');
            
        });


        $('#next_text').click(function(e){
            e.preventDefault();
			$('.visible').first().toggleClass('visible').next().toggleClass('visible');
			if ($('.visible').attr('id') == 'photo_comments' || $('.visible').attr('id') == 'success_blue') {
                // hide the next button
                $('#next_text').hide();
			}
         
        });
		
        // ######################################
        // Radio Button Stuff
        // ######################################

		// Add unique IDs to all the jellyfish radio buttons and set the 'for' property on the labels
		var prevId = 0;
		$('.jellyfish label').each(function(i, label) {
			var id = 'radio-' + prevId;
            var label_id = 'label-'+id;
			$(label).prev().attr('id', id);
			$(label).attr('for', id);
            $(label).attr('id', label_id)
			prevId++;
		});

        // Change selected button's color
        // NOTE: NEED TO MAKE SURE THIS DOESN'T SCREW UP OTHER PAGES' STUFF
        $('#jellyfish_questions input[type="radio"]').click(function(){
            var name = $(this).attr('name');
            var id = $(this).attr('id');
            var unselected_color = 'gray';
            var selected_color = 'orange';
            $('[name='+name+']').each(function(){ //changes the colors of the rest of the buttons
                $(this).next().css('background-color', unselected_color);
            });
            if (id=='none'){
                $('#jellyfish_questions label').css('background-color', unselected_color);
                $('#label-none').css('background-color', selected_color); 
                $('.jellyfish input[type="radio"]').each(function(){
                    $(this).prop('checked', false);
                });
                $('#label-none').prop('checked', true);
            } else {
                $('#label-none').css('background-color', unselected_color);
                $('#label-'+id).css('background-color', selected_color); //changes the color of the selected button
                $('#label-none').prop('checked', false);
            }
        });


        // ######################################
        // Send Form Data
        //
        //
        // NOTES 
        //
        // 1. edit the jellyfish names in the python file
        // 2. edit the microalgae blooms to be macroalgae
        // 3. weather thing???
        // 4. move fonts into css file? idk
        // 5. what do i do abt the none thing
        // 6. need to add photo + comment functionality thing? 
        //
        // ######################################

        $('#form').submit(function(event){

            event.preventDefault(); // just 4 checking stuff. delete later

            var sighting = {};

            // *********** Jellyfish Species Counts *********** 

            var species_counts = {};
            $('div.jellyfish').each(function(){
                var jelly_name = $(this).children('p').text();
                if ($(this).children('input:checked').length>0){
                    var count = $(this).children('input:checked').val();
                    species_counts[jelly_name] = count;
                };
            });

            // *********** Nearby Species *********** 

            var nearby_species = $("input[name=marine]:checked").map(function(){
                return this.value;
            }).get();

            // *********** Macroalgae *********** 

            var microalgae_blooms_obj = $("input[name=macroalgae]:checked").map(function(){
                return this.value;
            }).get();

            if ($('#macroalgae_other').val()!=""){
                microalgae_blooms_obj.push($('#macroalgae_other').val());
            }

            // *********** Water Clarity *********** 

            var water_clarity = $("input[name=water]:checked").val();

            // *********** Attached Seaweed *********** 

            var attached_seaweed_val = $("input[name=seaweed]:checked").val();
            var attached_seaweed;
            if (attached_seaweed_val=="Yes"){
                attached_seaweed = true;
            } else if (attached_seaweed_val=="No"){
                attached_seaweed = false;
            } else { //nothing was checked
            }

            // *********** Water Use *********** 

            var water_uses = $("input[name=water_use]:checked").map(function(){
                return this.value;
            }).get();

            // *********** Time + Date *********** 

            var today = new Date();
            var hour = today.getHours() % 12 || 12;
            
            var ampm; //format AM/PM
            if (today.getHours()<12){
                ampm = " AM";
            } else {
                ampm = " PM";
            };

            var minutes; //format minutes
            if (today.getMinutes()<10){
                minutes="0"+String(today.getMinutes());
            } else {
                minutes=String(today.getMinutes());
            }

            var current_time = String(hour)+":"+minutes+ampm;
            var current_date = String(today.getMonth()+1)+"/"+String(today.getDate())+"/"+String(today.getFullYear());

             // *********** Comments *********** 
            var text = $('#photo_comments').find('input[name="comments"]').val();
            var comment_input;
            if (text){
                comment_input = text;
            }
            else{
                comment_input = "None";
            }
            // * * * * * * * * * * * * * * * * * * * * * * * 
            //          Putting it All Together 
            // * * * * * * * * * * * * * * * * * * * * * * *  

            sighting["lat"] = lat;
            sighting["lng"] = lng;
            sighting["species_counts"] = species_counts;
            sighting["nearby_species"] = nearby_species;
            sighting["microalgae_blooms"] = microalgae_blooms_obj;
            sighting["water_clarity"] = water_clarity;
            sighting["attached_seaweed"] = attached_seaweed; 
            sighting["water_uses"] = water_uses;
            sighting["time_of_day"] = current_time;
            sighting["date"] = current_date;
            sighting["photo_url"] = url; 
            sighting["comment_input"] = comment_input;

            Data.submitSighting(sighting, function(response){
                if (response["success"] == true){
                    $('#photo_comments').hide();
                    $('#success').show();
                    $('#prev_text').hide(); 
                    $('#main_page').show(); 


                };
            });

        });
    //getting the url of photo
    $(function () {
        $(":file").change(function () {
            if (this.files && this.files[0]) {
				resizeImageFileForUpload(this.files[0], function(imgUrl) {
					$("#myImg").css('display', 'block').attr('src', imgUrl);
					url = imgUrl;
				})
            }
        });
    });

    </script>
</body>

</html>